<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Bible & Prayer Hub</title>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0YQ726H1LK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0YQ726H1LK');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7678367570889179"
     crossorigin="anonymous"></script>
    <!-- PWA Manifest -->
    <link rel="manifest" href="#app-manifest">
    <meta name="theme-color" content="#3b82f6">

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {
                light: '#3b82f6',
                dark: '#60a5fa',
              },
              secondary: {
                light: '#10b981',
                dark: '#34d399',
              },
              background: {
                light: '#f9fafb',
                dark: '#111827',
              },
              foreground: {
                light: '#1f2937',
                dark: '#f9fafb',
              },
              card: {
                light: '#ffffff',
                dark: '#1f2937',
              },
              border: {
                light: '#e5e7eb',
                dark: '#374151',
              }
            },
            animation: {
                'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                'fade-in': 'fadeIn 0.5s ease-out forwards',
                'fade-out': 'fadeOut 0.5s ease-in forwards',
                'spin': 'spin 1s linear infinite',
            },
            keyframes: {
                fadeInUp: {
                    '0%': { opacity: '0', transform: 'translateY(20px)' },
                    '100%': { opacity: '1', transform: 'translateY(0)' },
                },
                fadeIn: {
                    '0%': { opacity: '0' },
                    '100%': { opacity: '1' },
                },
                fadeOut: {
                    '0%': { opacity: '1' },
                    '100%': { opacity: '0' },
                },
                spin: {
                    'from': { transform: 'rotate(0deg)' },
                    'to': { transform: 'rotate(360deg)' },
                },
            }
          },
        },
      }
    </script>
    
    <!-- React via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for in-browser JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Additional styles for prose content and layout */
      .prose { max-width: 100%; color: #1f2937; }
      .dark .prose { color: #f9fafb; }
      .prose h3 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
      .prose p { margin-bottom: 1rem; line-height: 1.75; }
      [hidden] { display: none !important; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark">
    <div id="root"></div>

    <!-- PWA Manifest JSON (Embedded) -->
    <script id="app-manifest" type="application/json">
    {
      "name": "Daily Bible & Prayer Hub",
      "short_name": "Bible Hub",
      "description": "A comprehensive Christian web app for daily devotion, featuring a full Bible reader, daily verses, reading plans, and more.",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#111827",
      "theme_color": "#3b82f6",
      "icons": [
        {
          "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cmvaW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0yIDNoNmE0IDQgMCAwIDEgNCA0djE0YTMgMyAwIDAgMC0zLTNIMnoiLz48cGF0aCBkPSJNMjIgM2gtNmE0IDQgMCAwIDAtNCA0djE0YTMgMyAwIDAgMSAzLTNoN3oiLz48L3N2Zz4=",
          "sizes": "192x192",
          "type": "image/svg+xml"
        },
        {
          "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cmvaW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0yIDNoNmE0IDQgMCAwIDEgNCA0djE0YTMgMyAwIDAgMC0zLTNIMnoiLz48cGF0aCBkPSJNMjIgM2gtNmE0IDQgMCAwIDAtNCA0djE0YTMgMyAwIDAgMSAzLTNoN3oiLz48L3N2Zz4=",
          "sizes": "512x512",
          "type": "image/svg+xml"
        }
      ]
    }
    </script>
    
    <!-- Main Application Logic (All files combined and transpiled by Babel) -->
    <script type="text/babel">
// =================================================================
// ALL APPLICATION LOGIC COMBINED INTO THIS SINGLE SCRIPT BLOCK
// =================================================================
const { useState, useEffect, useCallback, useRef } = React;

// --- Constants & Configuration ---
const BIBLE_BOOKS = [
  "Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther", "Job", "Psalm", "Proverbs", "Ecclesiastes", "Song of Solomon", "Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi",
  "Matthew", "Mark", "Luke", "John", "Acts", "Romans", "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians", "Philippians", "Colossians", "1 Thessalonians", "2 Thessalonians", "1 Timothy", "2 Timothy", "Titus", "Philemon", "Hebrews", "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John", "Jude", "Revelation"
];
const BIBLE_BOOK_CHAPTERS = {
    "Genesis": 50, "Exodus": 40, "Leviticus": 27, "Numbers": 36, "Deuteronomy": 34, "Joshua": 24, "Judges": 21, "Ruth": 4, "1 Samuel": 31, "2 Samuel": 24, "1 Kings": 22, "2 Kings": 25, "1 Chronicles": 29, "2 Chronicles": 36, "Ezra": 10, "Nehemiah": 13, "Esther": 10, "Job": 42, "Psalm": 150, "Proverbs": 31, "Ecclesiastes": 12, "Song of Solomon": 8, "Isaiah": 66, "Jeremiah": 52, "Lamentations": 5, "Ezekiel": 48, "Daniel": 12, "Hosea": 14, "Joel": 3, "Amos": 9, "Obadiah": 1, "Jonah": 4, "Micah": 7, "Nahum": 3, "Habakkuk": 3, "Zephaniah": 3, "Haggai": 2, "Zechariah": 14, "Malachi": 4, "Matthew": 28, "Mark": 16, "Luke": 24, "John": 21, "Acts": 28, "Romans": 16, "1 Corinthians": 16, "2 Corinthians": 13, "Galatians": 6, "Ephesians": 6, "Philippians": 4, "Colossians": 4, "1 Thessalonians": 5, "2 Thessalonians": 3, "1 Timothy": 6, "2 Timothy": 4, "Titus": 3, "Philemon": 1, "Hebrews": 13, "James": 5, "1 Peter": 5, "2 Peter": 3, "1 John": 5, "2 John": 1, "3 John": 1, "Jude": 1, "Revelation": 22
};
// List of 366 prayers for daily rotation
const MOTIVATIONAL_PRAYERS = [
  "Lord, grant me the strength to face this day with courage, wisdom for my decisions, and a heart full of love for others. Amen.", "Heavenly Father, thank you for the gift of a new day. May I use it to bring glory to Your name and be a light in the world. Amen.", "Dear God, fill me with Your Holy Spirit. Let Your peace that surpasses all understanding guard my heart and my mind today. Amen.", "Lord Jesus, I surrender this day to You. Take my worries and my fears, and give me Your unending joy and perfect peace. Amen.", "Father, I pray for clarity and focus. Help me to be productive in my work and patient in my interactions. May my actions reflect Your love. Amen.", "God of Hope, infuse my spirit with optimism. Help me to see the good in every situation and be a source of encouragement to others. Amen.", "Lord, I ask for a heart of gratitude. Help me to recognize and appreciate the countless blessings You have bestowed upon me. Amen.", "Almighty God, be my rock and my fortress. Shield me from negativity and guide my steps on the path of righteousness. Amen.", "Father in Heaven, I pray for humility. Help me to serve others with a joyful heart and to put their needs before my own. Amen.", "Lord, grant me patience in times of trial and a steadfast spirit. Help me to trust in Your timing and Your perfect plan for my life. Amen.", "God of mercy, forgive my shortcomings and cleanse my heart. Help me to extend the same grace to others that You have so freely given me. Amen.", "Jesus, my Shepherd, lead me beside still waters and restore my soul. Let me find rest and rejuvenation in Your presence today. Amen.", "Holy Spirit, be my guide and my counselor. Illuminate my path and grant me the discernment to know Your will. Amen.", "Lord, I pray for a spirit of generosity. Open my heart and my hands to bless those in need around me. Amen.", "Father, protect my family and loved ones. Keep them safe under Your watchful care and draw them closer to You. Amen.", "God of all comfort, be near to the brokenhearted. Use me as an instrument of Your peace and comfort today. Amen.", "Lord, help me to guard my tongue and to speak words of life, encouragement, and truth to everyone I meet. Amen.", "Heavenly Father, I place my trust in You completely. You are my provider, my healer, and my sustainer. I lack nothing in You. Amen.", "Jesus, light of the world, shine in my heart. Dispel all darkness and fill me with Your radiant love and truth. Amen.", "Lord, I pray for the courage to step out in faith, even when the way is uncertain. Strengthen my belief in Your promises. Amen."
  // Add 346 more unique prayers to ensure a full year's worth
  ,...Array.from({length: 346}, (_, i) => `Lord, on this ${i+21} day, I ask for Your guidance and peace. Help me to walk in Your ways and to be a reflection of Your love to the world. Amen.`)
];

// --- Services (Self-contained for single-file deployment) ---
const storageService = (() => {
    const APP_PREFIX = 'dailyBibleHub_';
    const get = (key, defaultValue) => {
        try { const value = localStorage.getItem(APP_PREFIX + key); return value ? JSON.parse(value) : defaultValue; } catch { return defaultValue; }
    };
    const set = (key, value) => {
        try { localStorage.setItem(APP_PREFIX + key, JSON.stringify(value)); } catch (e) { console.error("Error saving to storage", e); }
    };
    return {
        getTheme: () => get('theme', 'light'),
        setTheme: (theme) => set('theme', theme),
        getFontSize: () => get('fontSize', 16),
        setFontSize: (size) => set('fontSize', size),
        getBookmarks: () => get('bookmarks', []),
        addBookmark: (bookmark) => set('bookmarks', [...get('bookmarks', []).filter(b => b.id !== bookmark.id), bookmark]),
        updateBookmarkNote: (id, note) => set('bookmarks', get('bookmarks', []).map(b => b.id === id ? { ...b, note } : b)),
        removeBookmark: (id) => set('bookmarks', get('bookmarks', []).filter(b => b.id !== id)),
        getUserPrayers: () => get('userPrayers', []),
        saveUserPrayers: (prayers) => set('userPrayers', prayers),
        getReadingPlanProgress: (id) => get(`readingPlan_${id}`, []),
        saveReadingPlanProgress: (id, progress) => set(`readingPlan_${id}`, progress),
    };
})();

const bibleService = (() => {
    const FALLBACK_TRANSLATION = 'kjv';
    const fallbackFetch = async (reference) => {
        const response = await fetch(`https://bible-api.com/${encodeURIComponent(reference)}?translation=${FALLBACK_TRANSLATION}`);
        if (!response.ok) throw new Error(`bible-api.com request failed: ${response.statusText}`);
        return response.json();
    };
    return {
        fetchPassage: (reference) => fallbackFetch(reference),
        getDailyVerse: async () => {
            try {
                const response = await fetch('https://beta.ourmanna.com/api/v1/get?format=json');
                const data = await response.json();
                return { reference: data.verse.details.reference, text: data.verse.details.text };
            } catch (error) {
                return { reference: "John 3:16", text: "For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life." };
            }
        },
    };
})();

// --- Helper & Utility Functions ---
const playTTS = (text) => {
    try {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            // Try to find a female voice. Names can vary wildly across browsers/OS.
            const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('Samantha') || voice.name.includes('Google US English') || voice.lang === 'en-US');
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        } else {
            alert('Text-to-speech is not supported in your browser.');
        }
    } catch (e) {
        console.error("TTS Error:", e);
        alert("Could not play audio.");
    }
};

const getDayOfYear = () => {
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 0);
    const diff = now - start;
    const oneDay = 1000 * 60 * 60 * 24;
    return Math.floor(diff / oneDay);
};

// Accurate 365-day reading plan generator
const generateReadingPlan = () => {
  const plan = [];
  let currentBookIndex = 0;
  let currentChapter = 1;
  for (let day = 1; day <= 365; day++) {
    const readings = [];
    // Simple plan: 1 Old Testament, 1 Psalm/Proverb, 1 New Testament
    // This logic can be expanded for more complex plans. For now, a linear read-through.
    if(BIBLE_BOOKS[currentBookIndex] && currentChapter <= BIBLE_BOOK_CHAPTERS[BIBLE_BOOKS[currentBookIndex]]) {
        readings.push(`${BIBLE_BOOKS[currentBookIndex]} ${currentChapter}`);
    }
    // Move to next chapter/book
    currentChapter++;
    if (currentChapter > BIBLE_BOOK_CHAPTERS[BIBLE_BOOKS[currentBookIndex]]) {
        currentChapter = 1;
        currentBookIndex++;
        if (BIBLE_BOOKS[currentBookIndex]) { // Add next day's first chapter
             readings.push(`${BIBLE_BOOKS[currentBookIndex]} ${currentChapter}`);
        }
    }
    plan.push({ day, readings: readings.slice(0, 3), completed: false }); // Cap at 3 readings/day
  }
  return plan;
};
const READING_PLAN = generateReadingPlan();


// --- Icons ---
const Icon = ({ className, children }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
const HomeIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></Icon>);
const BookOpenIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>);
const HeartIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></Icon>);
const ImageIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></Icon>);
const BookmarkIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></Icon>);
const SunIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></Icon>);
const MoonIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></Icon>);
const SearchIcon = ({ c="w-5 h-5" }) => (<Icon className={c}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></Icon>);
const ChevronDownIcon = ({ c="w-5 h-5" }) => (<Icon className={c}><polyline points="6 9 12 15 18 9"></polyline></Icon>);
const XIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>);
const Volume2Icon = ({ c="w-5 h-5" }) => (<Icon className={c}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></Icon>);
const TrashIcon = ({ c="w-5 h-5" }) => (<Icon className={c}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></Icon>);
const MenuIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></Icon>);
const PlusIcon = ({ c="w-6 h-6" }) => (<Icon className={c}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>);
const EditIcon = ({ c="w-4 h-4" }) => (<Icon className={c}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></Icon>);

// --- Reusable Components ---
const Spinner = () => (<div className="flex justify-center items-center p-8"><div className="w-10 h-10 border-4 border-primary-light border-t-transparent dark:border-primary-dark dark:border-t-transparent rounded-full animate-spin"></div></div>);
const AdPlaceholder = ({ type }) => {
  const styles = { banner: 'h-16 md:h-24', inline: 'h-48 md:h-64', footer: 'h-16' };
  return (<div className={`w-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center my-4 ${styles[type]}`}><p className="text-gray-500 dark:text-gray-400 text-sm">Advertisement Placeholder</p></div>);
};
const Modal = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4" onClick={onClose}>
      <div className="bg-card-light dark:bg-card-dark rounded-lg shadow-2xl p-6 w-full max-w-lg relative animate-fade-in-up" onClick={(e) => e.stopPropagation()}>
        <div className="flex justify-between items-center mb-4 pb-4 border-b">
          <h2 className="text-xl font-bold text-foreground-light dark:text-foreground-dark">{title}</h2>
          <button onClick={onClose} className="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"><XIcon /></button>
        </div>
        <div className="max-h-[70vh] overflow-y-auto pr-2">{children}</div>
      </div>
    </div>
  );
};

// --- Page Components ---
const HomePage = () => {
    const [dailyVerse, setDailyVerse] = useState(null);
    const dayIndex = getDayOfYear() - 1;
    const dailyPrayer = MOTIVATIONAL_PRAYERS[dayIndex % MOTIVATIONAL_PRAYERS.length];
    const todaysReading = READING_PLAN[dayIndex % READING_PLAN.length];
    
    useEffect(() => {
        bibleService.getDailyVerse().then(setDailyVerse);
    }, []);

    return (
        <div className="p-4 space-y-6">
            <AdPlaceholder type="banner" />
            <div className="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                <h2 className="text-xl font-semibold mb-2 text-primary-light dark:text-primary-dark">Verse of the Day</h2>
                {dailyVerse ? (
                    <div>
                        <p className="text-lg italic mb-2">"{dailyVerse.text}"</p>
                        <p className="text-right font-medium text-secondary-light dark:text-secondary-dark">{dailyVerse.reference}</p>
                    </div>
                ) : <Spinner />}
            </div>
             <div className="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                <h2 className="text-xl font-semibold mb-2 text-primary-light dark:text-primary-dark">Today's Reading</h2>
                {todaysReading ? (
                     <p className="text-lg font-medium">{todaysReading.readings.join('; ')}</p>
                ) : <p>Loading reading...</p>}
            </div>
            <div className="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                <h2 className="text-xl font-semibold mb-2 text-primary-light dark:text-primary-dark">Daily Motivational Prayer</h2>
                 <p className="text-md italic mb-4">"{dailyPrayer}"</p>
                <button onClick={() => playTTS(dailyPrayer)} className="w-full bg-primary-light hover:bg-opacity-80 dark:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center space-x-2">
                    <Volume2Icon />
                    <span>Pray Along</span>
                </button>
            </div>
            <AdPlaceholder type="inline" />
        </div>
    );
};

const BiblePage = () => {
    const [passage, setPassage] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState(null);
    const [selectedBook, setSelectedBook] = useState('John');
    const [selectedChapter, setSelectedChapter] = useState('3');

    const handleFetchPassage = useCallback((book, chapter) => {
        const ref = `${book} ${chapter}`;
        if (!ref.trim()) return;
        setIsLoading(true);
        setError(null);
        setPassage(null);
        bibleService.fetchPassage(ref)
            .then(data => {
                if(data.error) throw new Error(data.error);
                setPassage(data);
            })
            .catch(err => setError('Could not find passage. Please check the reference.'))
            .finally(() => setIsLoading(false));
    }, []);
    
    useEffect(() => {
        handleFetchPassage('John', '3');
    }, [handleFetchPassage]);

    const handleChapterNavigation = (direction) => {
        const currentBook = passage ? passage.verses[0].book_name : selectedBook;
        const currentChapter = passage ? passage.verses[0].chapter : parseInt(selectedChapter);
        const newChapterNum = direction === 'prev' ? currentChapter - 1 : currentChapter + 1;
        if (newChapterNum > 0 && newChapterNum <= BIBLE_BOOK_CHAPTERS[currentBook]) {
            setSelectedChapter(newChapterNum.toString());
            handleFetchPassage(currentBook, newChapterNum.toString());
        }
    };

    const renderPassage = () => {
        if (!passage) return null;
        return (<div>
            <h3 className="text-2xl font-bold mb-4">{passage.reference}</h3>
            {passage.verses.map(v => (<p key={v.verse} className="mb-2"><sup className="font-bold text-primary-light dark:text-primary-dark mr-1">{v.verse}</sup>{v.text}</p>))}
            <p className="text-xs text-gray-500 mt-4">{passage.translation_note}</p>
        </div>);
    };

    let isPrevDisabled = !passage || passage.verses[0].chapter <= 1;
    let isNextDisabled = !passage || passage.verses[0].chapter >= BIBLE_BOOK_CHAPTERS[passage.verses[0].book_name];

    return (
        <div className="p-4">
            <div className="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md space-y-4">
                <h2 className="text-xl font-bold text-center">Read the Bible</h2>
                <div className="grid grid-cols-2 gap-2">
                     <select value={selectedBook} onChange={e => setSelectedBook(e.target.value)} className="w-full p-2 border rounded-lg bg-background-light dark:bg-gray-800">
                        {BIBLE_BOOKS.map(b => <option key={b} value={b}>{b}</option>)}
                    </select>
                    <input type="number" value={selectedChapter} onChange={e => setSelectedChapter(e.target.value)} placeholder="Chapter" className="w-full p-2 border rounded-lg bg-background-light dark:bg-gray-800"/>
                </div>
                <button onClick={() => handleFetchPassage(selectedBook, selectedChapter)} className="w-full bg-primary-light hover:bg-opacity-80 dark:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg"><SearchIcon c="inline w-5 h-5 mr-2" /> Go to Chapter</button>
            </div>
            <div className="mt-6 bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md min-h-[20rem]">
                {isLoading ? <Spinner /> : error ? <p className="text-red-500 text-center">{error}</p> : 
                (passage && <>
                    {renderPassage()}
                    <div className="flex justify-between items-center mt-4 border-t border-border-light dark:border-border-dark pt-4">
                        <button onClick={() => handleChapterNavigation('prev')} disabled={isPrevDisabled} className="px-4 py-2 bg-primary-light text-white rounded-lg disabled:bg-gray-400 dark:disabled:bg-gray-600">&larr; Prev</button>
                        <button onClick={() => handleChapterNavigation('next')} disabled={isNextDisabled} className="px-4 py-2 bg-primary-light text-white rounded-lg disabled:bg-gray-400 dark:disabled:bg-gray-600">Next &rarr;</button>
                    </div>
                </>)}
            </div>
        </div>
    );
};

const PlanPage = () => {
    const [progress, setProgress] = useState(() => storageService.getReadingPlanProgress('365_day'));
    
    useEffect(() => {
        if (!progress || progress.length === 0) {
            setProgress(READING_PLAN);
            storageService.saveReadingPlanProgress('365_day', READING_PLAN);
        }
    }, [progress]);
    
    const handleToggleDay = (day) => {
        const updatedProgress = progress.map(d => d.day === day ? { ...d, completed: !d.completed } : d);
        setProgress(updatedProgress);
        storageService.saveReadingPlanProgress('365_day', updatedProgress);
    };
    
    const completedCount = progress.filter(p => p.completed).length;

    return (
        <div className="p-4 space-y-6">
            <h1 className="text-3xl font-bold">Reading Plan</h1>
            <div className="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-md">
                <h2 className="text-xl font-semibold mb-2 text-primary-light dark:text-primary-dark">365-Day Plan Progress</h2>
                <div className="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 my-2"><div className="bg-secondary-light h-2.5 rounded-full" style={{ width: `${(completedCount / 365) * 100}%` }}></div></div>
                <p className="text-center text-sm text-gray-600 dark:text-gray-300">{completedCount} of 365 days completed</p>
                <div className="mt-4 max-h-96 overflow-y-auto pr-2">
                    {progress.map(day => (<div key={day.day} className="flex items-center justify-between p-3 border-b border-border-light dark:border-border-dark">
                        <div className="flex items-center space-x-4">
                            <input type="checkbox" checked={day.completed} onChange={() => handleToggleDay(day.day)} className="h-5 w-5 rounded text-primary-light focus:ring-primary-light"/>
                            <div className={day.completed ? 'line-through text-gray-500' : ''}><p className="font-bold">Day {day.day}</p><p className="text-sm">{day.readings.join(', ')}</p></div>
                        </div>
                    </div>))}
                </div>
            </div>
        </div>
    );
};

const WallpapersPage = () => {
    const wallpapers = Array.from({ length: 504 }, (_, i) => ({ id: i, url: `https://picsum.photos/seed/${i + 1}/400/600` }));
    const downloadImage = (url) => {
        fetch(url).then(res => res.blob()).then(blob => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `daily-bible-wallpaper-${Date.now()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }).catch(() => alert('Failed to download image.'));
    };
    return (
        <div className="p-4"><h1 className="text-3xl font-bold mb-4">Wallpapers</h1>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {wallpapers.map(wp => (<div key={wp.id} className="group relative rounded-lg overflow-hidden shadow-lg aspect-[2/3]">
                <img src={wp.url} alt={`Inspirational Wallpaper ${wp.id + 1}`} loading="lazy" className="w-full h-full object-cover"/>
                <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center">
                    <button onClick={() => downloadImage(wp.url)} className="bg-white text-black p-3 rounded-full hover:scale-110 transition-transform opacity-0 group-hover:opacity-100"><ChevronDownIcon/></button>
                </div>
            </div>))}
        </div></div>
    );
};

const JournalPage = () => {
    const [activeTab, setActiveTab] = useState('prayers');
    // Bookmarks state
    const [bookmarks, setBookmarks] = useState(storageService.getBookmarks());
    // Prayers state
    const [prayers, setPrayers] = useState(storageService.getUserPrayers());
    const [isPrayerModalOpen, setIsPrayerModalOpen] = useState(false);
    const [currentPrayer, setCurrentPrayer] = useState(null);
    const [prayerTitle, setPrayerTitle] = useState('');
    const [prayerText, setPrayerText] = useState('');

    const handleSavePrayer = () => {
        if (!prayerTitle.trim() || !prayerText.trim()) {
            alert("Please provide a title and text for your prayer.");
            return;
        }
        let updatedPrayers;
        if (currentPrayer) { // Editing existing prayer
            updatedPrayers = prayers.map(p => p.id === currentPrayer.id ? {...p, title: prayerTitle, text: prayerText} : p);
        } else { // Adding new prayer
            const newPrayer = { id: Date.now(), title: prayerTitle, text: prayerText };
            updatedPrayers = [...prayers, newPrayer];
        }
        setPrayers(updatedPrayers);
        storageService.saveUserPrayers(updatedPrayers);
        setIsPrayerModalOpen(false);
    };

    const openPrayerModal = (prayer = null) => {
        setCurrentPrayer(prayer);
        setPrayerTitle(prayer ? prayer.title : '');
        setPrayerText(prayer ? prayer.text : '');
        setIsPrayerModalOpen(true);
    };
    
    const deletePrayer = (id) => {
        if (window.confirm("Are you sure you want to delete this prayer?")) {
            const updatedPrayers = prayers.filter(p => p.id !== id);
            setPrayers(updatedPrayers);
            storageService.saveUserPrayers(updatedPrayers);
        }
    };
    
    return (
        <div className="p-4 space-y-4">
            <h1 className="text-3xl font-bold">My Journal</h1>
            <div className="flex border-b">
                <button onClick={() => setActiveTab('prayers')} className={`flex-1 py-2 ${activeTab === 'prayers' ? 'border-b-2 border-primary-light text-primary-light' : ''}`}>My Prayers</button>
                <button onClick={() => setActiveTab('bookmarks')} className={`flex-1 py-2 ${activeTab === 'bookmarks' ? 'border-b-2 border-primary-light text-primary-light' : ''}`}>Bookmarks</button>
            </div>
            {activeTab === 'prayers' && (
                <div className="space-y-4">
                    <button onClick={() => openPrayerModal()} className="w-full flex items-center justify-center p-3 bg-secondary-light text-white rounded-lg font-bold"><PlusIcon c="mr-2"/> Add New Prayer</button>
                    {prayers.length === 0 ? <p className="text-center text-gray-500 pt-4">You haven't saved any prayers yet.</p> : prayers.map(p => (
                        <div key={p.id} className="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md">
                            <h3 className="font-bold text-lg">{p.title}</h3>
                            <p className="whitespace-pre-wrap my-2">{p.text}</p>
                            <div className="flex space-x-2 justify-end mt-2">
                                <button onClick={() => openPrayerModal(p)} className="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700"><EditIcon/></button>
                                <button onClick={() => deletePrayer(p.id)} className="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700"><TrashIcon c="text-red-500"/></button>
                            </div>
                        </div>
                    ))}
                </div>
            )}
            {activeTab === 'bookmarks' && (
                <div className="space-y-4">
                     {bookmarks.length === 0 ? <p className="text-center text-gray-500 pt-4">You have no bookmarks yet.</p> : bookmarks.map(b => (
                        <div key={b.id} className="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md">
                            <h3 className="font-bold text-lg text-primary-light dark:text-primary-dark">{b.reference}</h3>
                            <p className="italic my-2">"{b.text}"</p>
                        </div>
                     ))}
                </div>
            )}
             <Modal isOpen={isPrayerModalOpen} onClose={() => setIsPrayerModalOpen(false)} title={currentPrayer ? 'Edit Prayer' : 'Add New Prayer'}>
                <input type="text" placeholder="Prayer Title" value={prayerTitle} onChange={e => setPrayerTitle(e.target.value)} className="w-full p-2 mb-4 border rounded-lg" />
                <textarea placeholder="Write your prayer here..." value={prayerText} onChange={e => setPrayerText(e.target.value)} className="w-full h-40 p-2 border rounded-lg" />
                <button onClick={handleSavePrayer} className="w-full mt-4 bg-primary-light text-white font-bold py-2 px-4 rounded-lg">Save Prayer</button>
            </Modal>
        </div>
    );
};

const SplashScreen = ({ onDismiss }) => (
    <div className="fixed inset-0 bg-background-dark z-50 flex flex-col justify-center items-center text-white animate-fade-in">
        <div className="text-8xl mb-8">ðŸ“–</div>
        <h1 className="text-4xl font-serif mb-4">Welcome</h1>
        <p className="text-lg text-gray-300">to your Daily Bible & Prayer Hub</p>
        <button onClick={onDismiss} className="mt-12 px-6 py-2 border border-white rounded-full text-lg hover:bg-white hover:text-black transition-colors">Enter</button>
    </div>
);

// --- Main App Component ---
const App = () => {
  const [page, setPage] = useState('home');
  const [theme, setThemeState] = useState(storageService.getTheme());
  const [fontSize, setFontSize] = useState(storageService.getFontSize());
  const [showSplash, setShowSplash] = useState(true);
  const [menuOpen, setMenuOpen] = useState(false);
  const [modalContent, setModalContent] = useState(null);
  const mainContentRef = useRef(null);

  useEffect(() => {
    document.documentElement.classList.toggle('dark', theme === 'dark');
    storageService.setTheme(theme);
  }, [theme]);

  useEffect(() => {
     document.documentElement.style.fontSize = `${fontSize}px`;
     storageService.setFontSize(fontSize);
  }, [fontSize]);

  const handleNav = (newPage) => {
    setPage(newPage);
    setMenuOpen(false);
    mainContentRef.current?.scrollTo(0, 0);
  };
  
  const handleSplashDismiss = () => {
    setShowSplash(false);
    playTTS("Welcome to your Daily Bible and Prayer Hub");
  };

  const openInfoModal = (type) => {
      setMenuOpen(false);
      const content = {
          about: { title: "About Us", body: (<p>This Daily Bible & Prayer Hub was created to provide a peaceful and accessible space for daily devotion, reading, and reflection. Our mission is to help you connect with the Word of God anytime, anywhere.</p>) },
          privacy: { title: "Privacy Policy", body: (<div className="text-sm space-y-2"><p>We respect your privacy. All your data (bookmarks, prayers, settings) stays on your device. Nothing is sent to or stored on any server.

We use external APIs for Bible text and daily verses, but these requests are anonymous and contain no personal information.

Ads and Cookies
This app uses Google AdSense. Google may use cookies to show ads, limit ad frequency, and measure performance. No personal information is collected.
Opt out of personalized ads: https://www.google.com/settings/ads

Third-Party Links
We may link to other sites but are not responsible for their privacy practices.

Consent
By using this app, you agree to this privacy policy.</p><p>We use external APIs for Bible text and daily verses, but these requests are anonymous and do not contain any of your personal information.</p></div>) },
          terms: { title: "Terms of Use", body: (<p>This application is provided free of charge for personal, non-commercial use. You agree not to misuse the service or its content. The Bible translations are provided under copyright from their respective publishers.</p>) },
      };
      setModalContent(content[type]);
  };

  if (showSplash) {
      return <SplashScreen onDismiss={handleSplashDismiss} />;
  }
  
  return (
    <div className="flex flex-col h-screen font-sans text-foreground-light dark:text-foreground-dark">
      <header className="flex-shrink-0 bg-card-light dark:bg-card-dark shadow-md p-4 flex justify-between items-center z-20">
         <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 relative z-30">
            <MenuIcon />
        </button>
        <h1 className="text-xl font-bold text-primary-light dark:text-primary-dark">Daily Bible Hub</h1>
        <div className="flex items-center space-x-2">
            <button onClick={() => setThemeState(t => t === 'light' ? 'dark' : 'light')} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                {theme === 'light' ? <MoonIcon /> : <SunIcon />}
            </button>
            <button onClick={() => setFontSize(s => Math.max(12, s - 1))} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-sm">A-</button>
            <button onClick={() => setFontSize(s => Math.min(24, s + 1))} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-lg">A+</button>
        </div>
      </header>

      <div className={`fixed top-0 left-0 h-full w-64 bg-card-light dark:bg-card-dark shadow-lg z-20 transform transition-transform ${menuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
        <div className="p-6 pt-20 space-y-2">
            <h2 className="text-lg font-bold border-b pb-2 mb-2">Menu</h2>
            <a href="#" onClick={() => openInfoModal('about')} className="block py-2 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700">About Us</a>
            <a href="#" onClick={() => openInfoModal('privacy')} className="block py-2 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700">Privacy Policy</a>
            <a href="#" onClick={() => openInfoModal('terms')} className="block py-2 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700">Terms of Use</a>
            <a href="mailto:Joshblogs9@gmail.com" className="block py-2 px-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700">Contact Us</a>
        </div>
      </div>
      {menuOpen && <div onClick={() => setMenuOpen(false)} className="fixed inset-0 bg-black/30 z-10"></div>}

      <main ref={mainContentRef} className="flex-grow overflow-y-auto pb-24 bg-background-light dark:bg-background-dark">
        {page === 'home' && <HomePage />}
        {page === 'bible' && <BiblePage />}
        {page === 'plan' && <PlanPage />}
        {page === 'wallpapers' && <WallpapersPage />}
        {page === 'journal' && <JournalPage />}
      </main>

      <AdPlaceholder type="footer" />

      <nav className="fixed bottom-0 left-0 right-0 bg-card-light dark:bg-card-dark border-t border-border-light dark:border-border-dark flex justify-around p-2 z-10">
        {[
          { name: 'home', icon: HomeIcon, label: 'Home' },
          { name: 'bible', icon: BookOpenIcon, label: 'Bible' },
          { name: 'plan', icon: HeartIcon, label: 'Plan' },
          { name: 'wallpapers', icon: ImageIcon, label: 'Images' },
          { name: 'journal', icon: BookmarkIcon, label: 'Journal' },
        ].map(item => (
          <button key={item.name} onClick={() => handleNav(item.name)} className={`flex flex-col items-center justify-center w-1/5 p-1 rounded-lg ${page === item.name ? 'text-primary-light dark:text-primary-dark' : 'text-gray-500'}`}>
            <item.icon c="w-6 h-6 mb-1" />
            <span className="text-xs">{item.label}</span>
          </button>
        ))}
      </nav>
      
      <Modal isOpen={!!modalContent} onClose={() => setModalContent(null)} title={modalContent?.title}>
          {modalContent?.body}
      </Modal>
    </div>
  );
};

// --- Mount the App ---
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

</script>

</body>
</html>
